# è¶…æ—¶é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜

æµ‹è¯• 400â†’120 é…ç½®æ—¶å‡ºç°ï¼š
```
âœ— HTTP 504 é”™è¯¯
å“åº”å†…å®¹: {"detail":"Prediction timeout after 30 seconds"}
```

## ğŸ” æ ¹æœ¬åŸå› 

æœåŠ¡ä½¿ç”¨äº† `config.py` ä¸­çš„**ç¡¬ç¼–ç é»˜è®¤å€¼ 30 ç§’**ï¼š

```python
# config.py ç¬¬ 45 è¡Œ
inference_timeout: int = Field(30, env="KRONOS_INFERENCE_TIMEOUT")
                              ^^^ é»˜è®¤ 30 ç§’ï¼
```

è™½ç„¶ï¼š
- `.env` æ–‡ä»¶è®¾ç½®äº† `KRONOS_INFERENCE_TIMEOUT=120`
- å¯åŠ¨è„šæœ¬è®¾ç½®äº† `export KRONOS_INFERENCE_TIMEOUT=120`

ä½† **120 ç§’å¯¹äº 400â†’120 é•¿åºåˆ—é¢„æµ‹ä»ç„¶ä¸å¤Ÿ**ï¼

## âœ… å·²ä¿®å¤

### 1. æ›´æ–° .env æ–‡ä»¶
```bash
# ä» 120 ç§’å¢åŠ åˆ° 240 ç§’
KRONOS_INFERENCE_TIMEOUT=240  # 4 åˆ†é’Ÿ
KRONOS_REQUEST_TIMEOUT=300    # 5 åˆ†é’Ÿ
```

### 2. æ›´æ–°å¯åŠ¨è„šæœ¬
```bash
# start_cpu_simple.sh
export KRONOS_INFERENCE_TIMEOUT=240
export KRONOS_REQUEST_TIMEOUT=300
```

### 3. åˆ›å»ºæ–°å¯åŠ¨è„šæœ¬
```bash
# start_cpu_simple_v2.sh - å¢å¼ºç‰ˆï¼Œæ˜¾å¼æ˜¾ç¤ºè¶…æ—¶é…ç½®
```

## ğŸš€ é‡å¯æœåŠ¡

**æ­¥éª¤**:

1. **åœæ­¢å½“å‰æœåŠ¡**  
   åœ¨è¿è¡ŒæœåŠ¡çš„ç»ˆç«¯æŒ‰ `Ctrl+C`

2. **å¯åŠ¨æœåŠ¡**ï¼ˆé€‰æ‹©ä¸€ç§æ–¹å¼ï¼‰

   æ–¹å¼ A - ä½¿ç”¨åŸè„šæœ¬ï¼ˆå·²æ›´æ–°ï¼‰:
   ```bash
   cd /data/ws/kronos/services
   ./start_cpu_simple.sh
   ```

   æ–¹å¼ B - ä½¿ç”¨æ–°è„šæœ¬ï¼ˆæ¨èï¼Œæ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼‰:
   ```bash
   cd /data/ws/kronos/services
   ./start_cpu_simple_v2.sh
   ```

3. **éªŒè¯é…ç½®**  
   å¯åŠ¨æ—¶åº”è¯¥çœ‹åˆ°ï¼š
   ```
   æ¨ç†è¶…æ—¶: 240ç§’
   è¯·æ±‚è¶…æ—¶: 300ç§’
   ```

4. **ç­‰å¾…æ¨¡å‹åŠ è½½**ï¼ˆ1-2 åˆ†é’Ÿï¼‰

5. **é‡æ–°è¿è¡Œæµ‹è¯•**
   ```bash
   cd /data/ws/kronos/services
   python test_cpu_prediction_400.py
   ```

## ğŸ“Š è¶…æ—¶é…ç½®å¯¹æ¯”

### ä¿®å¤å‰
```
ä»£ç é»˜è®¤:  30 ç§’  â† å¤ªçŸ­ï¼
å¯åŠ¨è„šæœ¬: 120 ç§’  â† ä»ä¸å¤Ÿ
.envæ–‡ä»¶: 120 ç§’  â† ä»ä¸å¤Ÿ
å®¢æˆ·ç«¯:   300 ç§’  â† æ­£å¸¸
```

### ä¿®å¤å
```
ä»£ç é»˜è®¤:  30 ç§’ï¼ˆè¢«è¦†ç›–ï¼‰
å¯åŠ¨è„šæœ¬: 240 ç§’  â† âœ“ è¶³å¤Ÿ
.envæ–‡ä»¶: 240 ç§’  â† âœ“ è¶³å¤Ÿ
å®¢æˆ·ç«¯:   300 ç§’  â† âœ“ è¶³å¤Ÿ
```

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œ400â†’120 æµ‹è¯•åº”è¯¥ï¼š
- **ä¸ä¼šè¶…æ—¶** âœ“
- **å®Œæˆæ—¶é—´**: 25-30 ç§’
- **æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡**: ååé‡çº¦ 4-5 ç‚¹/ç§’
- **ä¸åŸå§‹ example å¯¹æ¯”**: æ€§èƒ½ç›¸å½“

## ğŸ”§ å¦‚æœè¿˜æ˜¯è¶…æ—¶

å¦‚æœ 240 ç§’ä»ç„¶ä¸å¤Ÿï¼ˆä¸å¤ªå¯èƒ½ï¼‰ï¼Œç»§ç»­å¢åŠ ï¼š

```bash
# ç¼–è¾‘å¯åŠ¨è„šæœ¬
nano /data/ws/kronos/services/start_cpu_simple.sh

# ä¿®æ”¹ä¸º 10 åˆ†é’Ÿ
export KRONOS_INFERENCE_TIMEOUT=600
export KRONOS_REQUEST_TIMEOUT=720
```

## ğŸ’¡ ç»éªŒæ•™è®­

1. **Pydantic çš„ Field é»˜è®¤å€¼ä¼šè¢«ä½¿ç”¨**ï¼Œå³ä½¿ç¯å¢ƒå˜é‡å­˜åœ¨
2. **ç¯å¢ƒå˜é‡å¿…é¡»åœ¨æœåŠ¡å¯åŠ¨æ—¶è®¾ç½®**ï¼Œä¿®æ”¹ .env ä¸å¤Ÿ
3. **è¶…æ—¶å±‚çº§å¿…é¡»æ­£ç¡®**: `å®¢æˆ·ç«¯ > è¯·æ±‚ > æ¨ç†`
4. **é•¿åºåˆ—éœ€è¦æ›´é•¿è¶…æ—¶**: ä¸æ˜¯çº¿æ€§å…³ç³»

## ğŸ“ ç›¸å…³æ–‡ä»¶

- é…ç½®æ–‡ä»¶: `services/kronos_fastapi/.env`
- å¯åŠ¨è„šæœ¬: `services/start_cpu_simple.sh`
- å¢å¼ºè„šæœ¬: `services/start_cpu_simple_v2.sh`
- æµ‹è¯•è„šæœ¬: `services/test_cpu_prediction_400.py`
- è¶…æ—¶æ–‡æ¡£: `services/TIMEOUT_CONFIGURATION.md`
